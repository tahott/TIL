# localhost와 node version에서의 처리
며칠 전 로컬에서 동작 시키던 코드를 다른 환경에서 실행시켜 보았는데, http 요청이 실패를 하여서 찾아본 문제와 미처 몰랐던 것을 알게되어 간단하게 정리하고자한다.

## 상황
백엔드는 러스트로 동작 시키고 같은 프론트엔드는 Next.js를 사용하는 환경으로 개발을 하고 있었다. 개인 노트북에서 사용하다 잠깐 회사에서 사용하는 노트북으로 코드를 옮겨 실행하였는데, `connect ECONNREFUSED` 에러가 발생하며 프론트엔드 -> 백엔드로의 요청이 실패하는 것이다. 같은 코드인데 어디에선 되고 어디에서 안 될 때는 보통 환경세팅이나 버전 문제라고 생각하여 우선 노드 버전을 확인해 보기로 하였다. <br>
프론트가 문제인지 서버가 문제인지 알기 위해 포스트맨을 사용하여 서버에 요청을 보냈더니 응답값이 잘 온다. 그렇다면 프론트의 요청에서 문제가 발생하는 것이고 Next.js를 사용하고 있으니 Next.js의 버전 혹은 node의 문제일 것이라고 여겼다. package.json을 보면 동일한 Next.js 13을 사용하고 있고 node의 버전을 확인하니 기존 개발 환경에서는 node16을 사용하고 있었고 옮긴 곳에서는 node18을 사용하고 있었다. 문제는 node의 버전이었던 것일까? 몇가지 검색어를 조합하여 검색을 해보니 문제가 발생한 것에 대해 알 수 있었다.

## 문제
> [관련 깃허브 이슈](https://github.com/nodejs/node/issues/40537)<br>
[Node.js 세팅값](https://nodejs.org/api/dns.html#dnssetdefaultresultorderorder)

node17부터는 localhost를 ipv6 값으로 우선 탐색하게 되었다. localhost는 ipv4에서는 127.0.0.1이고 ipv6에서는 ::1이다. 백엔드에서 127.0.0.1의 값으로 서버를 열고 node18을 사용하는 Next.js에서 localhost로 요청을 하니 ::1의 호스트 값으로 요청이 가서 실패한 것이다.

## 정리
node18을 사용할 때는 명시적으로 127.0.0.1로 요청을 하니 서버와의 통신이 무사히 될 수 있었다. 혼자서 웹 개발을 하다보면 localhost가 익숙하기는 하지만 앞으로는 명시적인 값을 이용하는 것을 생각해 본다.
