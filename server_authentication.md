# 서버 인증
서버 인증과 관련하여 구현 방식과 방법에 대해 정리하고자 한다.

## Session / Cookie
- 전통적인 인증 방식
- Flow
  1. 자격증명을 통한 로그인 시도
  2. 로그인이 확인 되고 서버가 세션 아이디로 세션을 생성
  3. 생성 된 세션 아이디는 클라이언트에 쿠키로 저장
  4. 이후 클라이언트의 쿠키에 포함 된 세션 아이디와 서버에 저장 된 세션 아이디를 비교. 일치하는 경우 유효한 요청으로 간주
- 일반적으로 세션 아이디는 크기가 작아 클라이언트 측에서 보관에 용이하다
- 웹을 사용한다면 쿠키는 브라우저에서 지원하므로 사용하기에 쉽다
- 탈취 당할 수 있으므로 보호 조치가 필요하다
  - 세션 아이디에는 민감한 데이터를 표기하지 않고 무작위로 생성 된 아이디를 사용한다
  - 쿠키에 httpOnly, Secure를 사용하여 https로만 전송을 하고 자바스크립트단에서 호출을 방지한다
- 탈취를 당했을 때 서버측에서 강제로 연결을 끊을 수 있다
- 서버의 메모리에 저장 되기 때문에 redis같은 외부 메모리 저장소를 이용하는 구성도 고려해야 한다
- 루트 도메인이 있는 웹사이트에 적합하다

## Token
- 최근 웹/앱 어플리케이션의 일반적인 인증 방식
- 일반적으로 Token이라 함은 Json Web Token을 뜻한다
- Flow
  1. 자격증명을 통한 로그인 시도
  2. 로그인이 확인 되고 서버가 서명 된 토큰을 반환
  3. 클라이언트는 서명 된 토큰을 저장 (cookie, sessionStorage, localStorage, etc...)
  4. 이후 요청 시 클라이언트는 header의 `Authorization` 값을 이용하여 서버로 전송
  5. 서버는 토큰값을 디코딩하여 유효한 경우 처리
- 상태를 비저장하므로 확장성 있게 사용 할 수 있다
- 세션을 이용한 조회보다 향상 된 속도를 가질 수 있다
- 세션 아이디에 비하여 큰 크기를 사용
- 탈취 당하기 쉬우며 이후 서버에서 무효화 하기가 어렵다
  - 그리하여 토큰을 생성 할 때 refresh token을 생성하여 서버측에서 관리한다
    - 이렇게 하면 세션과 마찬가지로 서버측에서 관리하는 포인트가 늘어나게 되는데 토큰 인증의 장점이 하나 줄어드는 것과 같다. 하지만 보안을 위해 고려해야 할 부분이긱도 하다
  - access token의 만료 시간은 짧게, refresh token은 길게
