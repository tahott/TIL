# Node.js에서 겪은 메모리 누수 현상
- 새로운 스케줄러를 배포한 뒤, 모니터링 중 메모리 사용량이 점점 증가하다 설정해둔 메모리 임계치를 넘어서서 주기적으로 서버가 재시작 되는 현상을 발견하였다.
- 메모리 누수가 의심되었는데 우선 스케줄러 내부 코드를 보며 함수가 정상적으로 종료되는지 에러에 대한 예외처리가 되어있는지 확인을 하였다.
- 이후에도 같은 현상이 발생하여 데이터를 복사하여 로컬에서 실행 시켜 보았다. 문제가 되는 부분을 확인 할 수 있었다. 스케줄러 시간 내에 데이터의 양을 다 처리하지 못 했고 스케줄러가 계속하여 실행하였다. 힙에 할당 된 메모리가 해제되지 않고 점점 메모리 사용량이 증가하면서 발생하였던 것이다.
- 당면한 문제는 스케줄러 시간을 조정해서 해결하였다. 하지만 임시방편에 가깝다.
- 이번 현상으로 느낀점을 남겨 후에 비슷한 일이 발생했을 때 이 글을 꺼내 좀 더 쉽게 해결하기를 바란다.

# 데이터를 다루는 건 개발자의 몫
JSON 상하차를 주로 하는 웹서버 개발자를 하며 느끼는 것은 어떤 데이터를 다루는지 얼마나 처리할지를 정할 수 있는건 직접적으로 다루는 개발자니깐 그 부분은 잘 인지하고 개발하여야 한다고 생각한다. 위와 같은 메모리 누수도 시간 안에 처리 할 수 있는 데이터양을 인지 했다면 발생하지 않았을것이다.

# Node.js의 gc
Node.js는 싱글 스레드여서 가비지 컬렉터도 이벤트 루프를 통해 실행 된다. GC는 적절한 때에 실행되어 힙에 할당된 메모리를 해제한다고 하는데, GC가 끼어들 틈 없이 바삐 돌아가기만 하는 로직이라면 이번처럼 메모리 누수로 서버가 다운 될 것이다. task가 긴 시간을 점유하지 않고 범위를 적절하게 조정하여야 한다.
